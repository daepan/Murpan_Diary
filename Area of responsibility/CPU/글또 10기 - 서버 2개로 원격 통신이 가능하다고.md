## 들어가며

최근 면접이나 다양한 기술 이야기를 나누면서 제 졸업 작품에 대한 관심을 많이 받게 되었습니다. 이 작품에서 사용된 핵심 기술 중 하나는 바로 **WebRTC**를 활용한 원격 화상 통화 시스템이었습니다. 당시 프로젝트를 진행하며 P2P 통신을 구현했었는데, 그 과정에서 STUN과 TURN 서버를 접하게 되었고, 기술적으로 많은 것을 배우는 계기가 되었습니다.

이 글에서는 당시의 경험을 돌아보며 제가 **왜 STUN과 TURN 서버를 선택했고, 어떤 한계와 고민이 있었는지**를 정리하려 합니다. 추가로, "이런 식으로 했다면 어땠을까?"라는 개선 아이디어도 함께 담아보았습니다. 이를 통해 WebRTC 실시간 통신을 더 깊이 이해하는 데 도움이 되길 바랍니다.


---

## 프로젝트 시나리오

제가 만든 프로젝트의 시나리오는 간단히 말해 **원격 의료 진단**입니다. 환자와 의사가 원격으로 화상 통화를 하며 진단을 진행할 수 있는 시스템을 구상했습니다.

![[{EB9A68ED-DBC9-4808-91A1-5C3BF20D8F46}.png]]
(당시 시나리오 만들 때 그림)

당시 제 접근 방식은 간단했습니다. **WebRTC에서 제공하는 ICE(Interactive Connectivity Establishment)** 를 활용해 자동으로 연결을 추적하고 P2P 통신을 설정하면 충분하다고 생각했습니다. 그러나 실제로 구현하면서 **NAT(Network Address Translation) 문제와 방화벽**이라는 현실적 제약에 부딪히게 되었고, 이를 해결하기 위해 STUN과 TURN 서버를 선택하게 되었습니다.

## 원격 통신에 필요한 서버: STUN과 TURN

**STUN(Session Traversal Utilities for NAT)**과 **TURN(Traversal Using Relays around NAT)** 서버는 WebRTC 통신에서 핵심적인 역할을 합니다. 두 서버는 P2P 연결을 가능하게 하거나, 중계를 통해 데이터를 안정적으로 전달하는 데 사용됩니다.

---

### STUN 서버: NAT 뒤에서도 P2P 연결 지원

STUN 서버는 **클라이언트가 자신의 공인 IP와 포트를 파악하고 NAT 뒤에서 통신할 수 있도록 지원하는 서버**입니다. 주요 역할은 다음과 같습니다:

1. **공인 IP와 포트 확인**  
    NAT를 통해 변경된 클라이언트의 공인 IP와 포트를 제공합니다.
2. **NAT 유형 탐지**  
    NAT의 유형(Full Cone, Symmetric 등)을 진단하여 연결 가능성을 평가합니다.
3. **P2P 연결 지원**  
    NAT 환경에서 직접 데이터를 주고받도록 연결을 설정합니다.

#### 장점

- 직접 연결이 가능한 경우 성능과 비용 면에서 매우 효율적입니다.
- 네트워크 자원을 적게 사용합니다.

#### 한계

- Symmetric NAT 또는 강력한 방화벽 환경에서는 제대로 작동하지 않을 수 있습니다.

---

### TURN 서버: P2P가 불가능할 때 데이터 릴레이

TURN 서버는 **P2P 연결이 실패한 경우 데이터를 중계하는 서버**입니다. 특히 Symmetric NAT나 방화벽으로 인해 직접 연결이 불가능한 환경에서 사용됩니다. 주요 역할은 다음과 같습니다:

1. **데이터 릴레이**  
    클라이언트 간 데이터를 TURN 서버를 통해 중계합니다.
2. **모든 네트워크 호환 보장**  
    복잡한 NAT 환경에서도 안정적으로 통신을 지원합니다.

#### 장점

- NAT와 방화벽 설정에 관계없이 통신 가능.
- 안정성과 호환성을 보장.

#### 한계

- 대역폭 사용량이 많아 서버 비용이 증가합니다.
- 성능이 STUN 서버에 비해 떨어질 수 있습니다.

---

## STUN과 TURN 서버의 차이점

|**특징**|**STUN 서버**|**TURN 서버**|
|---|---|---|
|**주요 역할**|공인 IP와 NAT 매핑 탐지|데이터를 중계하여 통신 지원|
|**적용 시나리오**|P2P 연결이 가능한 경우|P2P 연결이 불가능한 경우|
|**비용**|낮음|높음|
|**네트워크 호환성**|제한적|모든 NAT 및 방화벽 환경에서 지원|

---

## WebRTC에서의 활용 사례

### 1. STUN 서버 활용

STUN 서버는 주로 **P2P 연결을 우선적으로 시도**하는 데 사용됩니다. 클라이언트가 자신의 공인 IP를 확인하고, NAT 매핑 정보를 통해 직접 데이터를 주고받을 수 있도록 지원합니다. WebRTC의 기본 연결 방식이 바로 STUN 서버를 기반으로 한 P2P 연결입니다.

**구현 코드 예시**:

javascript

코드 복사

`const peerConnection = new RTCPeerConnection({   iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] // Google STUN 서버 사용 });`

---

### 2. TURN 서버 활용

TURN 서버는 **STUN 서버로 P2P 연결이 실패한 경우** 사용됩니다. 클라이언트 간 데이터를 TURN 서버로 보내고, 이를 상대 클라이언트에게 중계하여 통신을 가능하게 합니다. 이는 Symmetric NAT나 강한 방화벽 환경에서 반드시 필요한 요소입니다.

**구현 코드 예시**:

javascript

코드 복사

`const peerConnection = new RTCPeerConnection({   iceServers: [     { urls: 'stun:stun.l.google.com:19302' },     { urls: 'turn:turn.example.com', username: 'user', credential: 'password' } // TURN 서버 추가   ] });`

---

## 프로젝트 회고와 개선 아이디어

### 당시 선택의 이유

졸업 작품에서는 Google STUN 서버를 사용해 P2P 연결을 설정했습니다. 하지만 일부 네트워크 환경에서는 연결이 실패해 TURN 서버를 추가로 고려해야 했습니다. 당시 TURN 서버를 구성하지 않았던 이유는 **비용 문제와 구현 시간 부족** 때문이었습니다.

### 개선 아이디어

- **TURN 서버 구성**  
    AWS EC2에 [Coturn](https://github.com/coturn/coturn)을 설치해 비용을 최소화하면서 TURN 서버를 구축할 수 있습니다.
    
- **P2P 우선 전략**  
    STUN 서버로 P2P 연결을 우선 시도하고, 실패 시 TURN 서버로 대체하는 구조를 구현해 효율성을 높일 수 있습니다.

---

## 마치며

STUN과 TURN 서버는 WebRTC의 근간을 이루는 기술로, **실시간 통신에서 안정적인 연결을 보장하기 위해 서로 보완적인 역할을 합니다**. STUN 서버는 효율적인 P2P 연결을 지원하며, TURN 서버는 복잡한 네트워크 환경에서도 확실한 데이터 전송을 보장합니다.

하지만 이 두 기술을 적절히 활용하기 위해서는 각 기술의 한계와 비용을 명확히 이해하고, 애플리케이션에 맞는 전략을 설계해야 합니다. 이번 글이 WebRTC에서 STUN과 TURN 서버의 활용 방식을 이해하는 데 도움이 되었기를 바랍니다.