## 들어가며

이번에 면접과 여러 군데를 돌아다니면서 생각보다 많은 관심을 받는 저의 졸작에 사용된 기술 이 있습니다. 바로 WebRT
웹 실시간 통신(WebRTC)을 처음 사용하거나 프로젝트에서 구현해 본 개발자라면 **STUN**과 **TURN 서버**라는 용어를 들어봤을 것입니다. 저 역시 WebRTC를 활용해 1:1 영상 통신을 구현하는 프로젝트를 진행하며 이 기술을 접하게 되었고, "과연 내가 STUN과 TURN 서버를 제대로 이해하고 있는 걸까?"라는 질문이 떠올랐습니다.

그래서 이번 글에서는 **STUN과 TURN 서버가 각각 어떤 역할을 하고, 어떤 상황에서 사용되는지**를 면밀히 분석해 보려고 합니다. WebRTC를 처음 접하는 분들뿐 아니라, 실무에서 더 나은 네트워크 연결 전략을 고민하는 분들께 도움이 되었으면 합니다.

---

## STUN과 TURN 서버란?

**STUN(Session Traversal Utilities for NAT)**과 **TURN(Traversal Using Relays around NAT)** 서버는 WebRTC에서 네트워크 통신을 원활하게 하기 위해 사용됩니다. 두 서버는 서로 다른 목적과 사용 사례를 가지고 있으며, WebRTC 연결의 성패를 좌우하는 중요한 구성 요소입니다.

### STUN 서버

STUN 서버는 **클라이언트가 자신의 공인 IP와 포트를 파악하고 NAT(Network Address Translation) 뒤에서도 통신할 수 있도록 도와주는 서버**입니다. 주로 P2P 연결을 설정할 때 사용되며, 아래와 같은 역할을 합니다:

1. **공인 IP와 포트 제공**  
    NAT를 통해 변경된 공인 IP 주소와 포트를 클라이언트가 파악할 수 있도록 도와줍니다.
2. **NAT 유형 탐지**  
    Full Cone, Restricted Cone, Symmetric NAT 등 NAT의 유형을 파악하여 연결 가능 여부를 진단합니다.
3. **P2P 연결 지원**  
    P2P 연결이 가능한 경우, 직접적인 데이터 교환을 설정합니다.

#### 주요 장점

- 직접 통신이 가능할 때 비용이 거의 들지 않음.
- 불필요한 중계 과정을 줄여 효율적인 연결 제공.

#### 한계

- **Symmetric NAT** 또는 방화벽이 강하게 설정된 네트워크 환경에서는 제대로 동작하지 않을 수 있음.

---

### TURN 서버

TURN 서버는 **P2P 연결이 불가능한 경우 데이터를 중계하는 서버**입니다. Symmetric NAT나 방화벽이 있는 환경에서 사용되며, WebRTC 통신의 "마지막 보루" 역할을 합니다.

1. **데이터 릴레이**  
    클라이언트 간 데이터를 TURN 서버를 통해 중계하여 안정적인 통신을 보장합니다.
2. **호환성 확보**  
    모든 NAT 유형과 네트워크 환경에서 동작할 수 있도록 지원합니다.

#### 주요 장점

- **Symmetric NAT**나 강한 방화벽 환경에서도 통신 가능.
- 안정적인 데이터 교환 보장.

#### 한계

- 중계 서버를 사용하는 방식이므로 대역폭 사용량 증가.
- 비용이 상대적으로 높음.

---

## STUN과 TURN 서버의 차이점

|**특징**|**STUN 서버**|**TURN 서버**|
|---|---|---|
|**주요 역할**|공인 IP와 NAT 매핑 탐지|데이터를 중계하여 통신 가능|
|**적용 시나리오**|P2P 연결이 가능한 경우|P2P 연결이 불가능한 경우|
|**비용**|낮음|높음|
|**네트워크 호환성**|제한적|모든 NAT 및 방화벽 환경에서 지원|

---

## WebRTC에서의 활용 사례

### 1. STUN 서버 활용

STUN 서버는 주로 **P2P 연결을 우선적으로 시도**하는 데 사용됩니다. 클라이언트가 자신의 공인 IP를 확인하고, NAT 매핑 정보를 통해 직접 데이터를 주고받을 수 있도록 지원합니다. WebRTC의 기본 연결 방식이 바로 STUN 서버를 기반으로 한 P2P 연결입니다.

**구현 코드 예시**:

javascript

코드 복사

`const peerConnection = new RTCPeerConnection({   iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] // Google STUN 서버 사용 });`

---

### 2. TURN 서버 활용

TURN 서버는 **STUN 서버로 P2P 연결이 실패한 경우** 사용됩니다. 클라이언트 간 데이터를 TURN 서버로 보내고, 이를 상대 클라이언트에게 중계하여 통신을 가능하게 합니다. 이는 Symmetric NAT나 강한 방화벽 환경에서 반드시 필요한 요소입니다.

**구현 코드 예시**:

javascript

코드 복사

`const peerConnection = new RTCPeerConnection({   iceServers: [     { urls: 'stun:stun.l.google.com:19302' },     { urls: 'turn:turn.example.com', username: 'user', credential: 'password' } // TURN 서버 추가   ] });`

---

## STUN과 TURN의 비용과 한계

WebRTC에서 STUN과 TURN은 실시간 통신의 핵심이지만, 각각의 한계와 비용을 이해하고 올바르게 활용하는 것이 중요합니다.

1. **STUN 서버의 한계**
    
    - NAT 유형에 따라 작동하지 않을 수 있음.
    - 방화벽 설정이 복잡한 환경에서는 제한적.
2. **TURN 서버의 비용**
    
    - 데이터를 중계해야 하므로 **서버 대역폭 사용량 증가**.
    - 대규모 트래픽이 발생하는 애플리케이션에서는 상당한 비용 발생 가능.

---

## 마치며

STUN과 TURN 서버는 WebRTC의 근간을 이루는 기술로, **실시간 통신에서 안정적인 연결을 보장하기 위해 서로 보완적인 역할을 합니다**. STUN 서버는 효율적인 P2P 연결을 지원하며, TURN 서버는 복잡한 네트워크 환경에서도 확실한 데이터 전송을 보장합니다.

하지만 이 두 기술을 적절히 활용하기 위해서는 각 기술의 한계와 비용을 명확히 이해하고, 애플리케이션에 맞는 전략을 설계해야 합니다. 이번 글이 WebRTC에서 STUN과 TURN 서버의 활용 방식을 이해하는 데 도움이 되었기를 바랍니다.