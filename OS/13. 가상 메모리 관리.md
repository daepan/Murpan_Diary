### 가상 메모리 관리

- **배경**
    
    - 전체 프로그램의 모든 부분이 동시에 필요하지 않을 수 있습니다.
- **가상 메모리**는 사용자의 논리 메모리와 물리 메모리를 분리합니다.
    
    - 실행을 위해 프로그램의 일부만 메모리에 있어야 합니다.
    - 따라서 논리 주소 공간은 물리 주소 공간보다 훨씬 클 수 있습니다.
    - 페이지를 스왑 인(swap in) 및 스왑 아웃(swap out)할 수 있어야 합니다 (디스크).
    - 여러 프로세스가 주소 공간을 공유할 수 있습니다.
    - 더 효율적인 프로세스 생성을 허용합니다.
- **가상 메모리 구현 방법**:
    
    - 수요 페이징(Demand paging)
    - 수요 세그먼테이션(Demand segmentation)

### 스왑 공간

- **스왑 공간의 추가**는 운영 체제가 여러 동시 실행 프로세스에 대한 큰 가상 메모리의 환상을 지원할 수 있게 합니다.
- 디스크에 페이지를 왕복 이동하기 위한 일부 공간을 예약합니다.
- 운영 체제는 페이지 크기 단위로 스왑 공간을 기억해야 합니다.

![[Pasted image 20240421140928.png]]


### 물리 메모리보다 큰 가상 메모리

- **수요 페이징(Demand Paging)**
    - 필요할 때만 페이지를 메모리로 가져옵니다 (지연 스왑핑).
        - 더 적은 I/O가 필요합니다.
        - 더 적은 메모리가 필요합니다.
        - 더 빠른 응답이 가능합니다.
        - 더 많은 사용자를 수용할 수 있습니다.
    - **유효-무효 비트(Valid-invalid bit)**
        - 각 페이지 테이블 항목에 유효-무효 비트가 연관됩니다.
            - 1은 메모리 내, 0은 메모리 외.
        - 초기에 모든 항목의 유효-무효 비트는 0으로 설정됩니다.
        - 주소 변환 동안, 페이지 테이블 항목의 유효-무효 비트가 0이면 페이지 폴트가 발생합니다.
![[Pasted image 20240421141027.png]]
### 페이지 테이블: 일부 페이지가 주 메모리에 없을 때

- **페이지 폴트(Page Fault)**
    - 물리 메모리에 없는 페이지에 접근합니다.
        - 페이지가 현재 없고 디스크에 스왑되었다면, 운영 체제는 페이지 폴트를 처리하기 위해 메모리로 페이지를 스왑해야 합니다.
    - **운영 체제 결정**
        - 잘못된 참조라면 중단합니다.
        - 메모리에 없는 경우 메모리로 가져옵니다.
            - 비어 있는 프레임을 찾습니다.
            - 페이지를 프레임으로 스왑합니다.
            - 테이블을 재설정하고, 유효 비트를 1로 설정합니다.
            - 명령을 재시작합니다
### 물리 메모리보다 큰 가상 메모리
![[Pasted image 20240421141520.png]]
- **수요 페이징(Demand Paging)**
    - 필요할 때만 페이지를 메모리로 가져옵니다 (지연 스왑핑).
        - 더 적은 I/O가 필요합니다.
        - 더 적은 메모리가 필요합니다.
        - 더 빠른 응답이 가능합니다.
        - 더 많은 사용자를 수용할 수 있습니다.
    - **유효-무효 비트(Valid-invalid bit)**
        - 각 페이지 테이블 항목에 유효-무효 비트가 연관됩니다.
            - 1은 메모리 내, 0은 메모리 외.
        - 초기에 모든 항목의 유효-무효 비트는 0으로 설정됩니다.
        - 주소 변환 동안, 페이지 테이블 항목의 유효-무효 비트가 0이면 페이지 폴트가 발생합니다.

### 페이지 테이블: 일부 페이지가 주 메모리에 없을 때

- **페이지 폴트(Page Fault)**
    - 물리 메모리에 없는 페이지에 접근합니다.
        - 페이지가 현재 없고 디스크에 스왑되었다면, 운영 체제는 페이지 폴트를 처리하기 위해 메모리로 페이지를 스왑해야 합니다.
    - **운영 체제 결정**
        - 잘못된 참조라면 중단합니다.
        - 메모리에 없는 경우 메모리로 가져옵니다.
            - 비어 있는 프레임을 찾습니다.
            - 페이지를 프레임으로 스왑합니다.
            - 테이블을 재설정하고, 유효 비트를 1로 설정합니다.
            - 명령을 재시작합니다
![[Pasted image 20240421141539.png]]