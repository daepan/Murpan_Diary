## Operating System Services
### 사용자 인터페이스

- **사용자 인터페이스(UI)**: 거의 모든 운영 시스템은 사용자 인터페이스를 제공합니다. 이는 명령줄 인터페이스(CLI), 그래픽 사용자 인터페이스(GUI), 배치 인터페이스 등으로 다양합니다.

### 프로그램 실행

- **프로그램 실행**: 시스템은 프로그램을 메모리에 로드하고 실행할 수 있어야 합니다. 또한, 정상적으로 또는 비정상적으로(오류를 나타내며) 실행을 종료할 수 있어야 합니다.

### 입출력 작업

- **I/O 작업**: 실행 중인 프로그램은 파일이나 I/O 장치를 포함한 입출력 작업을 요구할 수 있습니다.

### 파일 시스템 조작

- **파일 시스템 조작**: 파일 시스템은 프로그램에게 매우 중요합니다. 프로그램은 파일과 디렉토리를 읽고 쓰기, 생성 및 삭제, 검색, 파일 정보 나열, 권한 관리 등의 작업을 수행할 필요가 있습니다.

이러한 서비스들은 운영 시스템이 사용자의 컴퓨팅 경험을 향상시키는 데 중요한 역할을 합니다.

### 사용자를 위한 운영 시스템 서비스 (계속):

- **통신**: 프로세스들은 동일한 컴퓨터 내에서 또는 네트워크를 통해 다른 컴퓨터와 정보를 교환할 수 있습니다.
    - 통신은 공유 메모리나 메시지 전달(운영 시스템에 의해 이동되는 패킷)을 통해 이루어질 수 있습니다.
- **오류 감지**: 운영 시스템은 가능한 오류를 지속적으로 인지해야 합니다.
    - 오류는 CPU 및 메모리 하드웨어, I/O 장치, 사용자 프로그램에서 발생할 수 있습니다.
    - 각 유형의 오류에 대해, 운영 시스템은 올바르고 일관된 컴퓨팅을 보장하기 위해 적절한 조치를 취해야 합니다.
    - 디버깅 도구는 사용자와 프로그래머가 시스템을 효율적으로 사용할 수 있도록 크게 도움을 줄 수 있습니다.

### 시스템 자체의 효율적 운영을 위한 OS 기능:

- **자원 할당**: 여러 사용자나 여러 작업이 동시에 실행될 때, 자원은 각각에게 할당되어야 합니다.
    - 다양한 유형의 자원이 있으며, 일부(예: CPU 사이클, 주 메모리, 파일 저장소)는 특별한 할당 코드를 가질 수 있고, 다른 일부(예: I/O 장치)는 일반적인 요청 및 해제 코드를 사용할 수 있습니다.
- **회계**: 컴퓨터 자원을 얼마나, 어떤 종류를 사용하는지 추적합니다.
- **보호 및 보안**: 다중 사용자 또는 네트워크 컴퓨터 시스템에서 정보의 소유자는 해당 정보의 사용을 제어하길 원할 수 있습니다. 동시에 실행되는 프로세스들은 서로 간섭하지 않아야 합니다.

이러한 서비스들은 운영 시스템이 사용자와 시스템 자체의 요구를 충족시키는 데 중요한 역할을 합니다.

## 프로그램 직접 실행 예시

### 프로그램 직접 실행 과정

1. **프로세스 리스트에 항목 생성**: 실행할 프로그램에 대한 정보를 프로세스 리스트에 등록합니다.
2. **프로그램을 위한 메모리 할당**: 프로그램 실행에 필요한 메모리 공간을 할당합니다.
3. **프로그램을 메모리에 로드**: 할당된 메모리 공간에 프로그램을 로드합니다.
4. **스택 설정**: 프로그램 실행에 필요한 인자(argc / argv)와 함께 스택을 설정합니다.
5. **레지스터 초기화**: 모든 레지스터를 초기화합니다.
6. **main() 함수 호출**: 프로그램의 main() 함수를 호출하여 실행을 시작합니다.
7. **main() 실행**: main() 함수 내의 코드를 실행합니다.
8. **main() 반환 실행**: main() 함수의 반환을 처리합니다.
9. **프로세스의 메모리 해제**: 프로그램 실행이 완료되면 할당된 메모리를 해제합니다.
10. **프로세스 리스트에서 제거**: 실행이 완료된 프로그램을 프로세스 리스트에서 제거합니다.

이 과정은 운영 시스템이 프로그램을 효율적으로 관리하고 실행하는 방법을 보여줍니다. CPU 시간을 공유하며 시스템의 성능에 과도한 부담을 주지 않으면서 각 프로세스를 실행하는 방식을 설명하고 있습니다.

![[Pasted image 20240419224034.png]]


## 시스템  호출
### 시스템 호출이란?

- **제한된 작업 수행**: 프로세스가 디스크에 I/O 요청을 하거나 CPU나 메모리와 같은 추가 시스템 자원에 접근하고자 할 때 필요합니다.
- **보호된 제어 전환 사용**: 응용 프로그램은 하드웨어 자원에 대한 완전한 접근 권한을 가지지 않는 사용자 모드에서 실행됩니다. 반면, 운영 체제는 커널 모드에서 기계의 모든 자원에 접근할 수 있습니다.

### 시스템 호출을 통해 제공되는 기능:

- **파일 시스템 접근**
- **프로세스 생성 및 제거**
- **다른 프로세스와의 통신**
- **추가 메모리 할당**

### 시스템 호출의 프로그래밍 인터페이스:

- **운영 시스템이 제공하는 서비스에 대한 프로그래밍 인터페이스**로, 일반적으로 C나 C++ 같은 고급 언어로 작성됩니다.
- **API를 통한 접근**: 대부분의 프로그램은 직접적인 시스템 호출 사용보다 고급 어플리케이션 프로그램 인터페이스(API)를 통해 접근합니다.
- **가장 흔한 API**:
    - **Win32 API**: 윈도우 시스템을 위한 API
    - **POSIX API**: POSIX 기반 시스템(UNIX, Linux, Mac OS X의 거의 모든 버전 포함)을 위한 API
    - **Java API**: Java 가상 머신(JVM)을 위한 API

이러한 시스템 호출은 사용자 프로그램이 운영 체제의 보호된 자원과 기능에 안전하게 접근할 수 있도록 합니다. 이는 시스템의 안정성과 보안을 유지하는 중요한 메커니즘입니다.

![[Pasted image 20240419224616.png]]


이 그림은 API, 시스템 호출, 운영 체제 간의 관계를 도식화한 것입니다. 사용자 모드와 커널 모드를 구분하면서, 응용 프로그램이 운영 체제의 서비스를 어떻게 이용하는지 보여줍니다. 여기서의 주요 요소들은 다음과 같습니다:

- **사용자 응용 프로그램**: 사용자가 작성하고 실행하는 프로그램으로, 파일을 열 때 'open()'과 같은 함수를 사용할 수 있습니다.
    
- **시스템 호출 인터페이스**: 응용 프로그램과 커널 모드 사이의 인터페이스 역할을 합니다. 이를 통해 'open()'과 같은 시스템 호출을 실행할 수 있습니다.
    
- **'open()' 시스템 호출의 구현**: 커널 모드에서는 'open()' 함수의 구현이 실제로 어떻게 파일을 열고 관리하는지를 결정합니다. 이는 운영 체제의 깊은 부분에서 처리됩니다.
    
- **표준 C 라이브러리**: 'printf()'와 같은 라이브러리 함수를 사용하는 코드 예시를 보여줍니다. 이 함수는 내부적으로 'write()' 시스템 호출을 사용하여 텍스트를 출력합니다.
    

이 도식은 운영 체제가 사용자 프로그램으로부터의 요청을 시스템 호출을 통해 어떻게 처리하는지를 나타냅니다. 사용자는 API를 통해 시스템 자원을 요청하고, 운영 체제는 이러한 요청을 받아들여 커널 모드에서 처리한 후 결과를 반환합니다. 이 과정을 통해 프로그램은 하드웨어에 직접적으로 접근하지 않고도 필요한 작업을 수행할 수 있습니다.

### 시스템 호출 (System Call)

- **트랩 명령(Trap instruction)**:
    
    - 커널로 점프하여, 사용자 모드에서 커널 모드로 권한 레벨을 높입니다.
- **트랩 반환 명령(Return-from-trap instruction)**:
    
    - 호출한 사용자 프로그램으로 돌아가면서, 권한 레벨을 다시 사용자 모드로 낮춥니다.
- **인터럽트 또는 트랩 처리 중 다른 인터럽트가 발생하는 경우**:
    
    - 운영 시스템은 이러한 상황을 다루기 위해 인터럽트 처리 중에는 인터럽트를 비활성화합니다.
    - 내부 데이터 구조에 대한 동시 접근을 보호하기 위해 여러 복잡한 잠금 체계를 사용합니다.

### 제한된 직접 실행 프로토콜

- 부팅 시 운영 시스템은 트랩 테이블을 초기화하고, 시스템 호출 핸들러의 주소를 기억합니다.
- 사용자 모드에서 실행 중인 프로그램은 메인 함수를 실행하고 시스템 호출을 통해 운영 시스템으로 트랩합니다.
- 프로세스 리스트에 항목을 생성하고, 프로그램을 위한 메모리를 할당하며, 프로그램을 메모리에 로드합니다.
- 메인 함수에서 반환할 때, 시스템 종료를 위한 트랩을 사용하고, 트랩 처리 후 필요한 작업을 수행합니다.

### 시스템 호출 매개변수 전달

- 종종 시스템 호출의 식별 정보 외에 추가 정보가 필요합니다.
- 매개변수를 운영 시스템에 전달하는 세 가지 일반적인 방법은 다음과 같습니다:
    - 가장 간단한 방법은 레지스터를 통해 매개변수를 전달하는 것입니다. 하지만 매개변수가 레지스터의 수보다 많을 수 있습니다.
    - 메모리 내의 블록이나 테이블에 매개변수를 저장하고, 블록의 주소를 레지스터에 전달하는 방식으로, 리눅스와 솔라리스가 이 방법을 사용합니다.
    - 프로그램에 의해 스택에 매개변수를 푸시하고, 운영 시스템에 의해 스택에서 팝하는 방식입니다.
    - 블록과 스택 방법은 전달되는 매개변수의 수나 길이에 제한을 두지 않습니다.

이러한 설명은 프로그램이 운영 시스템의 기능을 요청할 때 시스템 호출을 어떻게 사용하는지를 나타냅니다. 또한, 운영 시스템은 이러한 요청을 안전하고 효과적으로 처리하기 위해 다양한 내부 메커니즘을 사용합니다.