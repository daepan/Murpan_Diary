#### Crash Consistency 문제

- 파일 시스템 데이터 구조는 지속적으로 보관되어야 합니다.
- 전원 손실이나 시스템 충돌이 발생하더라도 데이터 구조를 업데이트하는 것이 도전 과제입니다.

#### 예시 작업

- 기존 파일에 단일 데이터 블록(4KB) 추가
- 작업 순서: open() → lseek() → write() → close()

#### 충돌 시나리오

1. 단일 쓰기 성공
    
    - 데이터 블록만 쓰여진 경우: 문제 없음
    - 갱신된 inode만 쓰여진 경우: 파일 시스템 불일치 발생
    - 갱신된 비트맵만 쓰여진 경우: 공간 누수 발생
2. 두 개의 쓰기 성공
    
    - inode와 비트맵만 쓰여진 경우: 블록에 쓰레기 데이터가 있음
    - inode와 데이터 블록만 쓰여진 경우: inode와 비트맵 간 불일치
    - 비트맵과 데이터 블록만 쓰여진 경우: inode와 데이터 비트맵 간 불일치

#### Crash Consistency 문제 해결책

1. fsck (파일 시스템 체크)
    
    - Unix 도구로 불일치를 찾아서 수정
    - 모든 문제를 해결할 수는 없으며, 파일 시스템 메타데이터의 내부 일관성을 보장하는 것이 목표
2. 저널링 (Write-Ahead Logging)
    
    - 업데이트 전에 변경사항을 저널에 기록
    - 충돌 시 저널을 참조하여 복구 가능
    - 데이터 저널링과 메타데이터 저널링으로 나뉨

#### 저널링의 장점

- 충돌 시 데이터 복구가 용이
- 로그를 순환 구조로 사용하여 공간 절약

#### 추가적인 문제

- 잘못된 쓰기 (Misdirected Writes)와 손실된 쓰기 (Lost Writes)
- 디스크 스크러빙: 주기적으로 모든 블록을 읽고 체크섬 검사

#### 체크섬

- 데이터 무결성 확인을 위해 사용
- XOR, 덧셈 체크섬, Fletcher 체크섬, CRC와 같은 다양한 함수 사용

이 요약은 Crash Consistency 문제와 이를 해결하기 위한 fsck 및 저널링 방법에 대해 간략하게 설명합니다.

